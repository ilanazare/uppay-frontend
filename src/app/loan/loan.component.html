<div class="loan-container">
  <h2>Empréstimos</h2>

  <nav>
    <a routerLink="/customer" routerLinkActive="active">Clientes</a>
    <a routerLink="/fee" routerLinkActive="active">Taxas</a>  
    <a href="#" (click)="logout($event)" class="logout-link">Sair</a>
</nav>
  
  <form [formGroup]="loanForm" (ngSubmit)="onSubmit()" novalidate>
    <div class="form-group">
      <label for="tableNumber">Número da tabela:</label>
      <select id="tableNumber" formControlName="tableNumber" class="form-control">
        <option *ngFor="let option of tableOptions" [value]="option">{{option}}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="customer">Nome do cliente:</label>
      <input id="customer" type="text" formControlName="customer" class="form-control" placeholder="Entre com o nome do cliente">
      <div *ngIf="loanForm.get('customer')?.invalid && loanForm.get('customer')?.touched" class="error-message">
        O nome do cliente é obrigatório e deve ter pelo menos 1 caractere
      </div>
    </div>

    <div class="form-group">
      <label for="flag">Carteira:</label>
      <select id="flag" formControlName="flag" class="form-control">
        <option *ngFor="let flag of creditCardFlags" [value]="flag">{{flag}}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="purchaseValue">Valor do empréstimo:</label>
      <input id="purchaseValue" type="number" formControlName="purchaseValue" class="form-control" min="1">
      <div *ngIf="loanForm.get('purchaseValue')?.invalid && loanForm.get('purchaseValue')?.touched" class="error-message">
        O valor do empéstimo deve ser maior que 1 real
      </div>
    </div>

    <div class="form-group">
      <label for="numberOfInstallments">Número de parcelas:</label>
      <input id="numberOfInstallments" type="number" formControlName="numberOfInstallments" class="form-control" min="1">
      <div *ngIf="loanForm.get('numberOfInstallments')?.invalid && loanForm.get('numberOfInstallments')?.touched" class="error-message">
        Número de parcelas é obrigatório
      </div>
    </div>

    <div class="button-group">
      <button type="submit" class="btn btn-primary" [disabled]="isLoading">
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        Enviar empréstimo
      </button>
      <button type="button" class="btn btn-secondary" (click)="onFindLoans()" [disabled]="isLoading || !loanForm.get('customer')?.value">
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        Encontrar empréstimo
      </button>
    </div>
  </form>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{errorMessage}}
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    {{successMessage}}
  </div>

  <div *ngIf="customerLoans.length > 0" class="loan-results">
    <h3>Empréstimos ao cliente</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Id</th>
          <th>Cliente</th>
          <th>Valor do empréstimo</th>
          <th>Número de parcelas</th>
          <th>Valor da parcela</th>
          <th>Valor retido pela máquina</th>
          <th>Valor liberado pela máquina</th>
          <th>Valor retido</th>
          <th>Valor liberado para o cliente</th>
          <th>Data do empréstimo</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let loan of customerLoans">
          <td>{{loan.id}}</td>
          <td>{{loan.customer}}</td>
          <td>{{loan.purchaseValue | currency:'BRL':'symbol':'1.2-2'}}</td>
          <td>{{loan.numberOfInstallments}}</td>
          <td>{{loan.installmentValue | currency:'BRL':'symbol':'1.2-2'}}</td>
          <td>{{loan.amountRetainedByMachine | currency:'BRL':'symbol':'1.2-2'}}</td>
          <td>{{loan.amountReleasedByMachine | currency:'BRL':'symbol':'1.2-2'}}</td>
          <td>{{loan.amountRetained | currency:'BRL':'symbol':'1.2-2'}}</td>
          <td>{{loan.amountReleasedForClient | currency:'BRL':'symbol':'1.2-2'}}</td>
          <td>{{formatDate(loan.purchaseDate)}}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>